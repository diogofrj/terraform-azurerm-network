<!-- T칤tulo do M칩dulo -->
# 游깷 Terraform AzureRM - Virtual Network

![Banner Sinqia](./docs/images/Module-banner.png)

# Como utilizar este m칩dulo

```hcl
# providers.tf
provider "azurerm" {
  features {
    resource_group {
      prevent_deletion_if_contains_resources = false
    }
  }
}
```

```hcl
# versions.tf
terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.17.0"
    }
    random = {
      source  = "hashicorp/random"
      version = "~> 3.5.1"
    }
  }
  required_version = ">= 1.10.0"
}
```

```hcl
# main.tf
module "labels" {
  source       = "git::https://github.com/diogofrj/templates-tf-modules.git//examples/azure/labels?ref=v0.0.1"
  project      = "myapp"
  environment  = "dev"
  region       = "eastus2"
}


module "vnet" {

  source  = "../../"

  # Por padr칚o, este m칩dulo n칚o criar치 um grupo de recursos. Informe o nome aqui
  # para usar um grupo de recursos existente. Caso contr치rio, defina o argumento
  # `create_resource_group = true`. A localiza칞칚o ser치 a mesma do grupo de recursos existente.
  resource_group_name            = "rg-shared-useast2-02"
  vnetwork_name                  = "vnet-shared-hub-useast2-002"
  location                       = "useast2"
  vnet_address_space             = ["10.1.0.0/16"]
  firewall_subnet_address_prefix = ["10.1.0.0/26"]
  gateway_subnet_address_prefix  = ["10.1.1.0/27"]
  create_network_watcher         = false

  # Adicionando plano padr칚o de DDoS e servidores DNS personalizados (opcional)
  create_ddos_plan = false

  # Sub-redes m칰ltiplas, delega칞칚o de servi칞o, endpoints de servi칞o, grupos de seguran칞a de rede
  # Essas s칚o sub-redes padr칚o com a configura칞칚o necess치ria. Confira README.md para mais detalhes.
  # A associa칞칚o de NSG ser치 automaticamente adicionada para todas as sub-redes listadas aqui.
  # Os dois primeiros intervalos de endere칞os do espa칞o de endere칞amento da VNet s칚o reservados para Gateway e Firewall.
  # Ex.: Para um espa칞o de endere칞o 10.1.0.0/16, o intervalo utiliz치vel come칞a em 10.1.2.0/24 para todas as sub-redes.
  subnets = {
    mgnt_subnet = {
      subnet_name           = "snet-management"
      subnet_address_prefix = ["10.1.2.0/24"]

      delegation = {
        name = "testdelegation"
        service_delegation = {
          name    = "Microsoft.ContainerInstance/containerGroups"
          actions = ["Microsoft.Network/virtualNetworks/subnets/join/action", "Microsoft.Network/virtualNetworks/subnets/prepareNetworkPolicies/action"]
        }
      }

      nsg_inbound_rules = [
        # [nome, prioridade, dire칞칚o, acesso, protocolo, intervalo_porta_destino, prefixo_endere칞o_origem, prefixo_endere칞o_destino]
        # Para usar padr칫es, use "" sem adicionar valores.
        ["weballow", "100", "Inbound", "Allow", "Tcp", "80", "*", "0.0.0.0/0"],
        ["weballow1", "101", "Inbound", "Allow", "", "443", "*", ""],
        ["weballow2", "102", "Inbound", "Allow", "Tcp", "8080-8090", "*", ""],
      ]

      nsg_outbound_rules = [
        ["ntp_out", "103", "Outbound", "Allow", "Udp", "123", "", "0.0.0.0/0"],
      ]
    }

    dmz_subnet = {
      subnet_name           = "snet-appgateway"
      subnet_address_prefix = ["10.1.3.0/24"]
      service_endpoints     = ["Microsoft.Storage"]

      nsg_inbound_rules = [
        ["weballow", "200", "Inbound", "Allow", "Tcp", "80", "*", ""],
        ["weballow1", "201", "Inbound", "Allow", "Tcp", "443", "AzureLoadBalancer", ""],
        ["weballow2", "202", "Inbound", "Allow", "Tcp", "9090", "VirtualNetwork", ""],
      ]

      nsg_outbound_rules = []
    }

    pvt_subnet = {
      subnet_name           = "snet-pvt"
      subnet_address_prefix = ["10.1.4.0/24"]
      service_endpoints     = ["Microsoft.Storage"]
    }
  }

  # Adicionando TAGs aos seus recursos no Azure (obrigat칩rio)
  tags = {
    ProjectName  = "demo-internal"
    Env          = "dev"
    Owner        = "user@example.com"
    BusinessUnit = "CORP"
    ServiceClass = "Gold"
  }
}
```
